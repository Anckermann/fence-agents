###############################################################################
###############################################################################
##
##  Copyright (C) 2006 Red Hat, Inc.
##  
##  This copyrighted material is made available to anyone wishing to use,
##  modify, copy, or redistribute it subject to the terms and conditions
##  of the GNU General Public License v.2.
##
###############################################################################
###############################################################################

include ../Makefile.top

TARGET=fence_virt
LINK=fence_xvm

fence_virt_SOURCES = mcast.c serial.c main.c options.c

INCLUDES=-I../include `nss-config --cflags` `nspr-config --cflags` \
	 `xml2-config --cflags`

# nss sucks in way too much stuff
LIBS+=-lnss3 `xml2-config --libs`

all: ${TARGET} ${LINK}

fence_xvm: ${TARGET}
	ln -snf $^ $@

fence_virt: ${fence_virt_SOURCES:.c=.o}
	$(CC) -o $@ $^ $(LIBS) -L../common -lfence_virt

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $^ $(INCLUDES)

install: all
	if [ ! -d ${sbindir} ]; then \
		install -d ${sbindir} ; \
	fi
	install -m755 ${TARGET} ${sbindir}
	ln -snf ${sbindir}/${TARGET} ${sbindir}/${LINK}

clean:
	rm -f ${TARGET} ${LINK} *.o *.d *~
